DROP TABLE GS_TAREFA CASCADE CONSTRAINTS;
DROP TABLE GS_META CASCADE CONSTRAINTS;
DROP TABLE GS_CATEGORIA CASCADE CONSTRAINTS;
DROP TABLE GS_USER CASCADE CONSTRAINTS;

CREATE TABLE GS_USER (
  ID_USUARIO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  NOME VARCHAR2(150) NOT NULL, -- NN
  EMAIL VARCHAR2(150) NOT NULL, -- NN
  SENHA VARCHAR2(200) NOT NULL,
  TIPO_TRABALHO VARCHAR2(20) DEFAULT 'Híbrido',
  
  CONSTRAINT UK_GS_USER_EMAIL UNIQUE (EMAIL),
  CONSTRAINT CK_USER_TIPO CHECK (TIPO_TRABALHO IN ('Home Office', 'Presencial', 'Híbrido'))
);


CREATE TABLE GS_CATEGORIA (
  ID_CATEGORIA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  NOME VARCHAR2(100) NOT NULL,
  TIPO VARCHAR2(50) NOT NULL,
  DESCRICAO VARCHAR2(200),
  
  CONSTRAINT CK_CAT_TIPO CHECK (TIPO IN ('TRABALHO', 'PESSOAL', 'SAUDE'))
);

CREATE TABLE GS_META (
  ID_META NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  DESCRICAO VARCHAR2(200) NOT NULL,
  HORAS_META NUMBER NOT NULL,
  STATUS VARCHAR2(20) DEFAULT 'Ativa',
  ID_USUARIO NUMBER NOT NULL,
  
  CONSTRAINT FK_META_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES GS_USER(ID_USUARIO),
  CONSTRAINT CK_META_STATUS CHECK (STATUS IN ('Ativa', 'Concluída', 'Cancelada'))
);

CREATE TABLE GS_TAREFA (
  ID_TAREFA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  TITULO VARCHAR2(200) NOT NULL,
  DESCRICAO CLOB,
  DURACAO_MIN NUMBER NOT NULL,
  DATA_TAREFA DATE DEFAULT SYSDATE NOT NULL,
  STATUS VARCHAR2(20) DEFAULT 'Pendente',
  ID_USUARIO NUMBER NOT NULL,
  ID_CATEGORIA NUMBER NOT NULL,
  
  CONSTRAINT FK_TAREFA_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES GS_USER(ID_USUARIO),
  CONSTRAINT FK_TAREFA_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES GS_CATEGORIA(ID_CATEGORIA),
  CONSTRAINT CK_TAREFA_STATUS CHECK (STATUS IN ('Pendente', 'Em Progresso', 'Concluída'))
);

INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Ana Silva', 'ana.silva@example.com', '123', 'Home Office');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Bruno Costa', 'bruno.costa@example.com', '123', 'Presencial');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Carla Nunes', 'carla.nunes@example.com', '123', 'Híbrido');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Diego Rocha', 'diego.rocha@example.com', '123', 'Home Office');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Eduarda Lima', 'eduarda.lima@example.com', '123', 'Híbrido');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Fernando Alves', 'fernando.alves@example.com', '123', 'Presencial');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Gabriela Melo', 'gabriela.melo@example.com', '123', 'Home Office');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Henrique Pinto', 'henrique.pinto@example.com', '123', 'Híbrido');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('Isabela Moraes', 'isabela.moraes@example.com', '123', 'Home Office');
INSERT INTO GS_USER (NOME, EMAIL, SENHA, TIPO_TRABALHO) VALUES ('João Pereira', 'joao.pereira@example.com', '123', 'Presencial');

INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Reunião', 'TRABALHO', 'Alinhamentos e Dailies');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Desenvolvimento', 'TRABALHO', 'Programação Focada');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Email', 'TRABALHO', 'Gestão de caixa de entrada');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Musculação', 'PESSOAL', 'Treino de força');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Alimentação', 'PESSOAL', 'Refeições principais');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Lazer', 'PESSOAL', 'Filmes e Jogos');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Estudo', 'PESSOAL', 'Leitura técnica');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Meditação', 'SAUDE', 'Mindfulness');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Médico', 'SAUDE', 'Consultas e exames');
INSERT INTO GS_CATEGORIA (NOME, TIPO, DESCRICAO) VALUES ('Pausa Ativa', 'SAUDE', 'Alongamento rápido');

INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Meta semanal dev', 40, 1, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Leitura mensal', 10, 1, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Academia 3x', 5, 2, 'Concluída');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Equilíbrio', 15, 3, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Foco total', 20, 4, 'Cancelada');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Pausas regulares', 7, 5, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Dormir bem', 56, 6, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Inglês', 8, 7, 'Concluída');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Lazer fds', 6, 8, 'Ativa');
INSERT INTO GS_META (DESCRICAO, HORAS_META, ID_USUARIO, STATUS) VALUES ('Yoga', 12, 9, 'Ativa');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Sprint planning', 'Planejar sprint', 60, SYSDATE, 1, 1, 'Concluída');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Codar API', 'Endpoint REST', 120, SYSDATE, 2, 2, 'Em Progresso');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Emails Clientes', 'Responder suporte', 30, SYSDATE, 3, 3, 'Pendente');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Corrida', '5km parque', 45, SYSDATE, 4, 4, 'Concluída');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Almoço', 'Restaurante', 60, SYSDATE, 5, 5, 'Pendente');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Netflix', 'Série nova', 90, SYSDATE, 6, 6, 'Concluída');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Ler livro', 'Capitulo 1', 30, SYSDATE, 7, 7, 'Pendente');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Meditar', 'Guiada', 10, SYSDATE, 8, 8, 'Concluída');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Dentista', 'Limpeza', 45, SYSDATE+1, 9, 9, 'Pendente');

INSERT INTO GS_TAREFA (TITULO, DESCRICAO, DURACAO_MIN, DATA_TAREFA, ID_USUARIO, ID_CATEGORIA, STATUS)
VALUES ('Alongar', 'Pescoco e costas', 10, SYSDATE, 10, 10, 'Pendente');

COMMIT;


-- Explicação: Listar usuários que trabalham em 'Home Office'
SELECT NOME, EMAIL, TIPO_TRABALHO
FROM GS_USER
WHERE TIPO_TRABALHO = 'Home Office'
ORDER BY NOME ASC;

-- Explicação: Recuperar detalhes das tarefas pendentes
SELECT 
    U.NOME AS USUARIO,
    T.TITULO AS TAREFA,
    T.STATUS,
    C.NOME AS CATEGORIA
FROM GS_TAREFA T
JOIN GS_USER U ON T.ID_USUARIO = U.ID_USUARIO
JOIN GS_CATEGORIA C ON T.ID_CATEGORIA = C.ID_CATEGORIA
WHERE T.STATUS = 'Pendente'
ORDER BY U.NOME;

-- Explicação: Contar quantas tarefas existem por Status
SELECT 
    STATUS, 
    COUNT(*) AS TOTAL_TAREFAS
FROM GS_TAREFA
GROUP BY STATUS;

-- Explicação: Identificar usuários que já acumularam mais de 100 minutos
-- em tarefas concluídas
SELECT 
    U.NOME, 
    SUM(T.DURACAO_MIN) AS MINUTOS_CONCLUIDOS
FROM GS_USER U
JOIN GS_TAREFA T ON U.ID_USUARIO = T.ID_USUARIO
WHERE T.STATUS = 'Concluída'
GROUP BY U.NOME
HAVING SUM(T.DURACAO_MIN) > 100
ORDER BY MINUTOS_CONCLUIDOS DESC;
